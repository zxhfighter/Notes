## 调研点

1.组件库如下两个特点如何论证：

- 可跨多端
- 支持 SSR 渲染

2. 图形库这个特点如何论证：

- 支持 SSR 渲染，使用第三方 npm 库，例如 puppeteer 可以实现服务端渲染，https://www.cnblogs.com/Johnzhang/p/9119711.html

3. Angular 组件库能节约的人力，大约 1/3 的人力，这个如何论证？

4. 上海车展，日均 PV 20w+，成都车展，日均 PV 10W+，百度指数移动版的日均 PV 是多少？

5. 品牌说，现在删掉自上线以来，因为还没有上线成功呢

6.脚手架工具开发

- 包含 table 基类
- 包含 form 基类
- 包含完整工作流，由于使用了 angular-cli，因此工作流主要包括了 mock 数据的处理

## TODO

- e2e 覆盖了哪些浏览器，browserStack？chrome ？e2e 实现原理。
- gulp scafford 脚手架一键生成组件和对应 demo，操作 AST 动态更新组件所在的模块


## 实现ssr需要解决的问题

- 非js资源引用的处理，上面已经说过
- 路由跳转如何处理
- 用户在客户端登录了，重新请求服务端页面，服务端如何加入用户已登录了的新状态
- 用户访问了服务端渲染的首页，客户端js加载完后还是会执行，组件componentDidMount()中的ajax请求如何避免触发

对于访问/、/home这两个路由，代理到ssr服务，来吐首页内容,api代理到后端服务,其他的直接返回(也就是说如果在detail页面或user页面刷新了页面还是之前客户端渲染那套)

在highcharts的官网可以看到不同平台的服务端导出实现，highcharts渲染后支持导出图片（svg、png、jpeg）以及pdf；默认情况下，点击导出的时候客户端会向highcharts服务器发送请求，然后服务器生成图片，响应到前端下载下来，但是这种并非是服务端渲染，而是前端发送渲染好的svg（xml）到服务器，服务端转换svg内容成图片文件，但是这种方式的前提是在浏览器端渲染完毕，服务端根据渲染结果做一些转换工作而已。


	【组件库技术方案】目前有三种：
1. 基于 angular-cli，在此基础上新增功能
2. 基于 gulp + rollup，在此基础上新增功能
3. 基于 angular-cli + gulp


	【调研中】调研度量衡规范，对组件进行分组和细分。
	【调研中】调研现有的组件库，包括 primeng、ngx-bootstrap、meta-magic、meterial-design 等等，目前最全的组件库还是 primeng。
	【调研中】是基于现有的组件库开发，还是开发一套全新的组件库？
	【调研中】是否开源。
	【调研中】组件库技术架构方案（功能配置、样式配置）。
	【调研中】组件库代码编写规范。
	【调研中】组件库文档规范。
	【调研中】组件库是否引入测试？单测还是e2e测试？组件库测试代码规范？
	【调研中】组件库示例（demo）

前端 Web 应用中的组件，是指一些设计为通用性的，用来构建较大型应用程序的软件，这些组件有多种表现形式。
它可以是有UI（用户界面）的，也可以是作为 “服务”的纯逻辑代码。因为有视觉上的表现形式，UI组件更容易理解。
UI组件简单的例子包括按钮、输入框和文本域。不论是汉堡包状的菜单按钮（无论你是否喜欢）、标签页、日历、选
项菜单或者所见即所得的富文本编辑器则是一些更加高级的例子。提供服务类型的组件可能会让人难以理解，这种类
型的例子包括跨浏览器的AJAX支持，日志记录或者提供某种数据持久化的功能。

基于组件开发，最重要的就是组件可以用来构成其他组件，而富文本编辑器就是个很好的例子。它是由按钮、下拉菜单
和一些可视化组件等组成。

## 为什么要组件库

### 高内聚

- 功能内聚
- 物理位置内聚，就近维护原则，HTML、JS、CSS 放同一个文件夹

将让组件更容易维护。


### 可重用

功能明确，实现清晰，API易于理解，自然就能促进组件复用。保持了 DRY（不要重复造轮子）原则。

### 可互换

要是程序内部的组件是松耦合的，那事实上可以用一个组件轻易地替换另一个组件，只要遵循相同的 API/接口/约定。

### 可组合

基于组件的架构让组件组合成新组件更加容易。这样的设计让组件更加专注。

由于系统功能被分治到独立的组件中，粒度比较精细，组织形式松散，开发者之间不会产生开发时序的依赖，大幅提升并行的开发效率，也更容易支持多个团队共同维护一个大型站点的开发。

![img](https://img-blog.csdn.net/20161128145551695)

所谓组件化，核心意义莫过于提取真正有复用价值的东西。那怎样的东西有复用价值呢？

组件化的本质目的并不一定是要为了可复用，而是提升可维护性。

如果这类组件在同一个界面中出现多次，就可能存在请求的浪费，因为有一个组件实例就会产生一个请求。 如果国家信息的配置界面与
这个组件同时存在，当我们在配置界面中新增一个国家了，下拉框组件中的数据并不会实时刷新。 第一个问题只是资源的浪费，第二个
就是数据的不一致了。曾经在很多系统中，大家都是手动刷新当前页面来解决这问题的，但到了这个时代，人们都是追求体验的，在一个
全组件化的解决方案中，不应再出现此类问题。

如何解决这样的问题呢？那就是引入一层Store的概念，每个组件不直接去到服务端请求数据，而是到对应的前端数据缓存中去获取数据
，让这个缓存自己去跟服务端保持同步。所以，在实际做方案的过程中，不管是基于Angular，React，Polymer，最后肯定都做出一层
Store了，不然会有很多问题。

从交互稿阶段开始，就让整个项目的产出物具有高度的一致性。

再优秀的组件库也没法「一招鲜吃遍天」。

需要考虑的列表项类型：单行式，双行式（带副标题或描述文字）、文章摘要式（纯文字/图文式）、列表标题和脚注、”查看更多“项、输入框（单行/多行，输入前/输入中/输入后）、滑块。

后端服务逐步倾向于微服务，简单来说就是将一个大型后端服务，拆分成多个小服务，它们分别部署，降低了开发的复杂性，而且提高了系统的可伸缩性。而前端方面，随着技术的发展，开发的复杂度也越来越高，传统开发模式总是存在着开发效率低，维护成本高等的弊端。

这种化繁为简（分治）的思想在后端开发中的体现是微服务，而在前端开发中的体现就是组件化。

前面讲了组件化开发的发展过程，那么我们该怎么做组件化呢？我认为组件应该遵守以下几个原则：



标准性

任何一个组件都应该遵守一套标准，可以使得不同区域的开发人员据此标准开发出一套标准统一的组件。




组合性

组件之前应该是可以组合的。我们知道前端页面的展示都是一些HTML DOM的组合，而组件在最终形态上也可以理解为一个个的HTML片段。那么组成一个完整的界面展示，肯定是要依赖不同组件之间的组合，嵌套以及通信。



重用性

任何一个组件应该都是一个可以独立的个体，可以使其应用在不同的场景中。



可维护性

任何一个组件应该都具有一套自己的完整的稳定的功能，仅包含自身的，与其它组件无关的逻辑，使其更加的容易理解，使其更加的容易理解，同时大大减少发生bug的几率。

在大型软件中，组件化是一种共识，它一方面提高了开发效率，另一方面降低了维护成本。

所谓组件化，核心意义莫过于提取真正有复用价值的东西。那怎样的东西有复用价值呢？

- 控件
- 基础逻辑功能
- 公共样式
- 稳定的业务逻辑


https://github.com/xufei/blog/issues/19


Angular 组件库

项目负责人

大型组件库的设计能力

由于商业平台推出了统一视觉规范 One Design，需要统一所有商业产品的交互和视觉，同时组内的技术栈基于 Angular，因此 Angular 组件库的需求迫在眉睫，需要开发一个基于 Angular 的符合设计规范的组件库。另外，由于系统功能被分治到独立的组件中，粒度比较精细，组织形式松散，开发者之间不会产生开发时序的依赖，大幅提升并行的开发效率，也更容易支持多个团队共同维护一个大型站点的开发。

职责：负责整个组件库的架构设计，基本工具搭建，以及核心组件开发（开发了 38 个组件中的 18 个）

项目成员：1个T6（王凤娇），4个T5（万凌锋，王崧，于泽，杨雪(已离职)）

角色分工：各自负责各自分配的若干组件，并行开发

组件库特点：丰富的组件（38+个），跨多平台，高质量，高性能，完整文档，简洁API，主题定制，完备工作流
同时，组件库在多个商业产品中使用，包括：Omni、百晓、OTT、新版灵犀等。

 组件库设计

    大型组件库的设计和架构能力得到了极大提升。

    Angular 组件库：由于商业平台推出了统一视觉规范，因此 Angular 组件库的需求迫在眉睫。期间带领 5个前端（1个T6，3个T5，1个T4），用了半年时间，开发了大约 38 个组件，自己开发了 18 个组件，包括很复杂的表格、日历、地域等组件。

    组件库具有全面性、高质量、可定执行、文档齐全、可跨多端、可多重模块方式引用、高性能等特点。

    此外，在组件库中引入了完整的工作流，可以一个命令，实现代码语法检测、测试、构建、文档生成、自动版本号更新、自动生成 ChangeLog、自动发布版本到 npm 等功能。

数据可视化

    数据可视化与产品结合的能力得到了极大提升。

    图形库：由于多个产品线使用了多个图形库或框架（有 Echarts2，Echarts3，d3，rapheal），造成维护起来比较困难，另外数据产品对可视化要求比较高，Echarts 无法满足要求。

    整个项目自己独立负责，通过调研相关可视化解决方案，和不同产品线 PM 讨论可视化的业务需求，提出了基于 D3 的图形库，对之前的图形进行统一，实现类似 Echarts 的数据驱动 API。目前已经开发了 11 种图形，更多的图形正在添加中。

    图形库的特点包括：数据驱动，API简洁；支持多重模块方式引用，支持 SSR 渲染，可以在线实时编辑选项预览图形效果等。

商业项目抽象能力

    对于大型商业项目的抽象能力得到了极大提升。

    通过开发了多个较大型的商业项目，对商业项目的常见模式进行了抽象，例如：项目的总体架构、表单、列表等。并据此开发相应的脚手架（脚手架可以灵活配置，进行模块和功能的增删），极大的提高新项目的开发效率和已有项目维护效率。

业务推动能力

    由于商业数据产品业务需求野蛮式发展，业务需求可能需要经常，快速的调整，除了做好本职工作之外，需要多个方向各进一步。经常和PM进行一些功能必要性的探讨，进行一些产品简化或升级；辅助 UE 进行一些交互和设计（尤其是一些复杂图形设计）；页面展现遇到性能瓶颈时，能推动 RD 进行相关性能升级。
